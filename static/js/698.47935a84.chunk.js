"use strict";(self.webpackChunkbsc_react=self.webpackChunkbsc_react||[]).push([[698],{66698:function(e,n,t){t.r(n),t.d(n,{default:function(){return I}});var r=t(74165),i=t(15861),s=t(15671),o=t(43144),c=t(20548),a=t.n(c),u=t(60136),h=t(27277),v=t(68041),d=t(31567),f=function(e){(0,u.Z)(t,e);var n=(0,h.Z)(t);function t(e){var r;return(0,s.Z)(this,t),(r=n.call(this,e)).events=new v.EventEmitter,r.hasRegisteredEventListeners=!1,r.connection=r.setConnection(e),r.connection.connected&&r.registerEventListeners(),r}return(0,o.Z)(t,[{key:"connect",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var n,t=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.length>0&&void 0!==t[0]?t[0]:this.connection,e.next=3,this.open(n);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.close();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"on",value:function(e,n){this.events.on(e,n)}},{key:"once",value:function(e,n){this.events.once(e,n)}},{key:"off",value:function(e,n){this.events.off(e,n)}},{key:"removeListener",value:function(e,n){this.events.removeListener(e,n)}},{key:"request",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.requestStrict((0,d.formatJsonRpcRequest)(n.method,n.params||[]),t));case 1:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"requestStrict",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t){var s=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=(0,i.Z)((0,r.Z)().mark((function e(i,o){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.connection.connected){e.next=9;break}return e.prev=1,e.next=4,s.open();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),o(e.t0);case 9:return s.events.on("".concat(n.id),(function(e){(0,d.isJsonRpcError)(e)?o(e.error):i(e.result)})),e.prev=10,e.next=13,s.connection.send(n,t);case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(10),o(e.t1);case 18:case"end":return e.stop()}}),e,null,[[1,6],[10,15]])})));return function(n,t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"setConnection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.connection;return e}},{key:"onPayload",value:function(e){this.events.emit("payload",e),(0,d.isJsonRpcResponse)(e)?this.events.emit("".concat(e.id),e):this.events.emit("message",{type:e.method,data:e.params})}},{key:"open",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var n,t=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.length>0&&void 0!==t[0]?t[0]:this.connection,this.connection!==n||!this.connection.connected){e.next=3;break}return e.abrupt("return");case 3:if(this.connection.connected&&this.close(),"string"!==typeof n){e.next=8;break}return e.next=7,this.connection.open(n);case 7:n=this.connection;case 8:return this.connection=this.setConnection(n),e.next=11,this.connection.open();case 11:this.registerEventListeners(),this.events.emit("connect");case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connection.close();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"registerEventListeners",value:function(){var e=this;this.hasRegisteredEventListeners||(this.connection.on("payload",(function(n){return e.onPayload(n)})),this.connection.on("close",(function(){return e.events.emit("disconnect")})),this.connection.on("error",(function(n){return e.events.emit("error",n)})),this.hasRegisteredEventListeners=!0)}}]),t}(d.IJsonRpcProvider),p=t(7605),l=t.n(p),g=t(76090),y={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"},k=function(){function e(n){if((0,s.Z)(this,e),this.url=n,this.events=new v.EventEmitter,this.isAvailable=!1,this.registering=!1,!(0,d.isHttpUrl)(n))throw new Error("Provided URL is not compatible with HTTP connection: ".concat(n));this.url=n}return(0,o.Z)(e,[{key:"connected",get:function(){return this.isAvailable}},{key:"connecting",get:function(){return this.registering}},{key:"on",value:function(e,n){this.events.on(e,n)}},{key:"once",value:function(e,n){this.events.once(e,n)}},{key:"off",value:function(e,n){this.events.off(e,n)}},{key:"removeListener",value:function(e,n){this.events.removeListener(e,n)}},{key:"open",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var n,t=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.length>0&&void 0!==t[0]?t[0]:this.url,e.next=3,this.register(n);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAvailable){e.next=2;break}throw new Error("Connection already closed");case 2:this.onClose();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t){var i,s,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAvailable){e.next=3;break}return e.next=3,this.register();case 3:return e.prev=3,i=(0,g.u)(n),e.next=7,l()(this.url,Object.assign(Object.assign({},y),{body:i}));case 7:return s=e.sent,e.next=10,s.json();case 10:o=e.sent,this.onPayload({data:o}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),this.onError(n.id,e.t0);case 17:case"end":return e.stop()}}),e,this,[[3,14]])})));return function(n,t){return e.apply(this,arguments)}}()},{key:"register",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var n,t,i,s=this,o=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>0&&void 0!==o[0]?o[0]:this.url,(0,d.isHttpUrl)(n)){e.next=3;break}throw new Error("Provided URL is not compatible with HTTP connection: ".concat(n));case 3:if(!this.registering){e.next=5;break}return e.abrupt("return",new Promise((function(e,n){s.events.once("register_error",(function(e){n(e)})),s.events.once("open",(function(){if("undefined"===typeof s.isAvailable)return n(new Error("HTTP connection is missing or invalid"));e()}))})));case 5:return this.url=n,this.registering=!0,e.prev=7,t=(0,g.u)({id:1,jsonrpc:"2.0",method:"test",params:[]}),e.next=11,l()(n,Object.assign(Object.assign({},y),{body:t}));case 11:this.onOpen(),e.next=20;break;case 14:throw e.prev=14,e.t0=e.catch(7),i=this.parseError(e.t0),this.events.emit("register_error",i),this.onClose(),i;case 20:case"end":return e.stop()}}),e,this,[[7,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"onOpen",value:function(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}},{key:"onClose",value:function(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}},{key:"onPayload",value:function(e){if("undefined"!==typeof e.data){var n="string"===typeof e.data?(0,g.D)(e.data):e.data;this.events.emit("payload",n)}}},{key:"onError",value:function(e,n){var t=this.parseError(n),r=t.message||t.toString(),i=(0,d.formatJsonRpcError)(e,r);this.events.emit("payload",i)}},{key:"parseError",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.url;return(0,d.parseConnectionError)(e,n,"HTTP")}}]),e}(),w=t(3194),m=t(78453),Z=t(62397),b=t.n(Z),x=function(e){(0,u.Z)(t,e);var n=(0,h.Z)(t);function t(e){var r;return(0,s.Z)(this,t),(r=n.call(this)).events=new(a()),r.accounts=[],r.chainId=1,r.pending=!1,r.bridge="https://bridge.walletconnect.org",r.qrcode=!0,r.qrcodeModalOptions=void 0,r.opts=e,r.chainId=(null===e||void 0===e?void 0:e.chainId)||r.chainId,r.wc=r.register(e),r}return(0,o.Z)(t,[{key:"connected",get:function(){return"undefined"!==typeof this.wc&&this.wc.connected}},{key:"connecting",get:function(){return this.pending}},{key:"connector",get:function(){return this.wc=this.register(this.opts),this.wc}},{key:"on",value:function(e,n){this.events.on(e,n)}},{key:"once",value:function(e,n){this.events.once(e,n)}},{key:"off",value:function(e,n){this.events.off(e,n)}},{key:"removeListener",value:function(e,n){this.events.removeListener(e,n)}},{key:"open",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connected){e.next=3;break}return this.onOpen(),e.abrupt("return");case 3:return e.abrupt("return",new Promise((function(e,r){t.on("error",(function(e){r(e)})),t.on("open",(function(){e()})),t.create(n)})));case 4:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof this.wc){e.next=2;break}return e.abrupt("return");case 2:this.wc.connected&&this.wc.killSession(),this.onClose();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.wc=this.register(this.opts),this.connected){e.next=4;break}return e.next=4,this.open();case 4:this.sendPayload(n).then((function(e){return t.events.emit("payload",e)})).catch((function(e){return t.events.emit("payload",(0,d.formatJsonRpcError)(n.id,e.message))}));case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"register",value:function(e){if(this.wc)return this.wc;this.opts=e||this.opts,this.bridge=(null===e||void 0===e?void 0:e.connector)?e.connector.bridge:(null===e||void 0===e?void 0:e.bridge)||"https://bridge.walletconnect.org",this.qrcode="undefined"===typeof(null===e||void 0===e?void 0:e.qrcode)||!1!==e.qrcode,this.chainId="undefined"!==typeof(null===e||void 0===e?void 0:e.chainId)?e.chainId:this.chainId,this.qrcodeModalOptions=null===e||void 0===e?void 0:e.qrcodeModalOptions;var n={bridge:this.bridge,qrcodeModal:this.qrcode?b():void 0,qrcodeModalOptions:this.qrcodeModalOptions,storageId:null===e||void 0===e?void 0:e.storageId,signingMethods:null===e||void 0===e?void 0:e.signingMethods,clientMeta:null===e||void 0===e?void 0:e.clientMeta};if(this.wc="undefined"!==typeof(null===e||void 0===e?void 0:e.connector)?e.connector:new m.Z(n),"undefined"===typeof this.wc)throw new Error("Failed to register WalletConnect connector");return this.wc.accounts.length&&(this.accounts=this.wc.accounts),this.wc.chainId&&(this.chainId=this.wc.chainId),this.registerConnectorEvents(),this.wc}},{key:"onOpen",value:function(e){this.pending=!1,e&&(this.wc=e),this.events.emit("open")}},{key:"onClose",value:function(){this.pending=!1,this.wc&&(this.wc=void 0),this.events.emit("close")}},{key:"onError",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Failed or Rejected Request",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-32e3,r={id:e.id,jsonrpc:e.jsonrpc,error:{code:t,message:n}};return this.events.emit("payload",r),r}},{key:"create",value:function(e){var n=this;this.wc=this.register(this.opts),this.chainId=e||this.chainId,this.connected||this.pending||(this.pending=!0,this.registerConnectorEvents(),this.wc.createSession({chainId:this.chainId}).then((function(){return n.events.emit("created")})).catch((function(e){return n.events.emit("error",e)})))}},{key:"registerConnectorEvents",value:function(){var e=this;this.wc=this.register(this.opts),this.wc.on("connect",(function(n){var t,r;n?e.events.emit("error",n):(e.accounts=(null===(t=e.wc)||void 0===t?void 0:t.accounts)||[],e.chainId=(null===(r=e.wc)||void 0===r?void 0:r.chainId)||e.chainId,e.onOpen())})),this.wc.on("disconnect",(function(n){n?e.events.emit("error",n):e.onClose()})),this.wc.on("modal_closed",(function(){e.events.emit("error",new Error("User closed modal"))})),this.wc.on("session_update",(function(n,t){var r=t.params[0],i=r.accounts,s=r.chainId;(!e.accounts||i&&e.accounts!==i)&&(e.accounts=i,e.events.emit("accountsChanged",i)),(!e.chainId||s&&e.chainId!==s)&&(e.chainId=s,e.events.emit("chainChanged",s))}))}},{key:"sendPayload",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.wc=this.register(this.opts),e.prev=1,e.next=4,this.wc.unsafeSend(n);case 4:return t=e.sent,e.abrupt("return",this.sanitizeResponse(t));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",this.onError(n,e.t0.message));case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(n){return e.apply(this,arguments)}}()},{key:"sanitizeResponse",value:function(e){return"undefined"!==typeof e.error&&"undefined"===typeof e.error.code?(0,d.formatJsonRpcError)(e.id,e.error.message):e}}]),t}(t(13594).XR),E=function(){function e(n){(0,s.Z)(this,e),this.events=new(a()),this.rpc={infuraId:null===n||void 0===n?void 0:n.infuraId,custom:null===n||void 0===n?void 0:n.rpc},this.signer=new f(new x(n));var t=this.signer.connection.chainId||(null===n||void 0===n?void 0:n.chainId)||1;this.http=this.setHttpProvider(t),this.registerEventListeners()}return(0,o.Z)(e,[{key:"connected",get:function(){return this.signer.connection.connected}},{key:"connector",get:function(){return this.signer.connection.connector}},{key:"accounts",get:function(){return this.signer.connection.accounts}},{key:"chainId",get:function(){return this.signer.connection.chainId}},{key:"rpcUrl",get:function(){var e;return(null===(e=this.http)||void 0===e?void 0:e.connection).url||""}},{key:"request",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n.method,e.next="eth_requestAccounts"===e.t0?3:"eth_accounts"===e.t0?6:"eth_chainId"===e.t0?7:8;break;case 3:return e.next=5,this.connect();case 5:case 6:return e.abrupt("return",this.signer.connection.accounts);case 7:return e.abrupt("return",this.signer.connection.chainId);case 8:return e.abrupt("break",9);case 9:if(!w.V7.includes(n.method)){e.next=11;break}return e.abrupt("return",this.signer.request(n));case 11:if("undefined"!==typeof this.http){e.next=13;break}throw new Error("Cannot request JSON-RPC method (".concat(n.method,") without provided rpc url"));case 13:return e.abrupt("return",this.http.request(n));case 14:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"sendAsync",value:function(e,n){this.request(e).then((function(e){return n(null,e)})).catch((function(e){return n(e,void 0)}))}},{key:"enable",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"eth_requestAccounts"});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer.connection.connected){e.next=3;break}return e.next=3,this.signer.connect();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.signer.connection.connected){e.next=3;break}return e.next=3,this.signer.disconnect();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"on",value:function(e,n){this.events.on(e,n)}},{key:"once",value:function(e,n){this.events.once(e,n)}},{key:"removeListener",value:function(e,n){this.events.removeListener(e,n)}},{key:"off",value:function(e,n){this.events.off(e,n)}},{key:"isWalletConnect",get:function(){return!0}},{key:"registerEventListeners",value:function(){var e=this;this.signer.connection.on("accountsChanged",(function(n){e.events.emit("accountsChanged",n)})),this.signer.connection.on("chainChanged",(function(n){e.http=e.setHttpProvider(n),e.events.emit("chainChanged",n)})),this.signer.on("disconnect",(function(){e.events.emit("disconnect")}))}},{key:"setHttpProvider",value:function(e){var n=(0,w.RM)(e,this.rpc);if("undefined"!==typeof n)return new f(new k(n))}}]),e}(),I=E}}]);